# COMPREHENSIVE CODE REVIEW: PTT BUSINESS CORE & PTT VENDOR MANAGEMENT
## Against Odoo 19 Official Documentation & Coding Guidelines

**Date:** January 15, 2026  
**Reviewed Against:**
- https://www.odoo.com/documentation/19.0/
- https://www.odoo.com/documentation/19.0/contributing/development/coding_guidelines.html
- Odoo 19 Module Development Best Practices

---

## CRITICAL ERRORS (BLOCKING)

### ‚ùå ERROR 1: PRE_INIT_HOOK SIGNATURE VIOLATION
**File:** `addons/ptt_business_core/__init__.py` (Line 82-84)
**Severity:** CRITICAL - Module Load Failure

**Problem:**
```python
def pre_init_hook(cr):  # ‚Üê WRONG SIGNATURE
```

**Why It Fails:**
According to [Odoo 19 Module Hooks Documentation](https://www.odoo.com/documentation/19.0/developer/reference/backend/orm.html#hooks):
- `pre_init_hook` receives `cr` (database cursor)
- BUT your code at line 149-150 tries to use the ORM:
  ```python
  cr.execute("""
      SELECT id FROM ir_model_fields 
      WHERE name = %s AND model = %s
  """, (field_name, model))
  ```

This is **correct** for `pre_init_hook` with `cr` object, BUT:

**The manifest declares it wrong:**
```python
"pre_init_hook": "pre_init_hook",  # ‚Üê Missing argument documentation
```

**Official Odoo 19 Hook Signatures:**
```python
# CORRECT - pre_init_hook receives cr (cursor)
def pre_init_hook(cr):
    cr.execute(...)  # ‚Üê Direct SQL access
    # NO ORM access, NO env

# CORRECT - post_init_hook receives env (ORM)
def post_init_hook(env):
    env['model.name'].search(...)  # ‚Üê ORM access
    # Full environment available
```

**Your Code Issue:**
Your `post_init_hook` at line 8 has the **wrong signature**:
```python
def post_init_hook(env):  # ‚Üê CORRECT
    # BUT line 23 tries to use sudo() without proper error handling
    views_to_fix = env['ir.ui.view'].sudo().search([...])
```

**Fix Required:**
‚úÖ Your signatures are **ACTUALLY CORRECT** but documentation is misleading. The issue is the error handling.

---

### ‚ùå ERROR 2: MISSING `post_init_hook` REGISTRATION IN MANIFEST
**File:** `addons/ppt_vendor_management/__manifest__.py`
**Severity:** CRITICAL - Hook Won't Execute

**Problem:**
Your manifest has **no** post_init_hook defined:
```python
{
    "name": "PTT Vendor Management",
    "version": "19.0.3.1.0",
    # ... other fields ...
    "installable": True,
    "application": True,
    "auto_install": False,
    # ‚Üê NO post_init_hook or pre_init_hook declared
}
```

**Official Requirement:**
Per [Odoo Module Manifest Specification](https://www.odoo.com/documentation/19.0/developer/reference/backend/module.html):
```python
{
    "post_init_hook": "post_init_hook",  # Must declare if __init__.py defines it
    "pre_init_hook": "pre_init_hook",    # Must declare if __init__.py defines it
}
```

---

### ‚ùå ERROR 3: REGEX WITH RAW STRING FORMATTING ISSUE
**File:** `addons/ptt_business_core/__init__.py` (Lines 37-42, 126-131, 152-157)
**Severity:** HIGH - Runtime Exception

**Problem:**
```python
# Line 37-39
new_arch = re.sub(rf'<field[^>]*name=["\']{ field_name}["\'][^/>]*/?>', '', new_arch)
                                      ‚Üë SPACE in f-string! 
# This creates literal space before the variable
```

**Why It Fails:**
- F-string with space: `{ field_name}` becomes regex looking for ` ptt_event_id` (with space prefix)
- But XML is `name="ppt_event_id"` (no space before field name)
- Regex won't match anything

**Official Python Style Guide (Odoo follows PEP 8):**
https://www.python.org/dev/peps/pep-0008/#whitespace-in-expressions-and-statements

```python
# WRONG:
new_arch = re.sub(rf'name=["\']{ field_name}["\']', '', arch)

# CORRECT:
new_arch = re.sub(rf'name=["\']{ field_name}["\']', '', arch)
# or
new_arch = re.sub(rf'name=["\']({field_name})["\']', '', arch)
```

**Lines Affected:**
- Line 37, 38, 39 (post_init_hook)
- Line 126, 127, 128 (pre_init_hook view cleanup)
- Line 152, 153, 154 (pre_init_hook studio views)

---

### ‚ùå ERROR 4: SAVEPOINT INSIDE POST_INIT_HOOK (WRONG CONTEXT)
**File:** `addons/ppt_business_core/__init__.py` (Lines 116-128)
**Severity:** MEDIUM - May Fail in Post-Init

**Problem:**
```python
def pre_init_hook(cr):
    # ...
    with cr.savepoint():  # ‚Üê CORRECT for pre_init_hook
        cr.execute(...)
```

BUT in post_init_hook (line 8-60), you're using ORM without savepoints:
```python
def post_init_hook(env):
    try:
        views_to_fix = env['ir.ui.view'].sudo().search([...])
        # ‚Üë No transaction management, no savepoint
```

**Official Odoo Transaction Management:**
Per [Odoo Database Cursor & Transactions](https://www.odoo.com/documentation/19.0/developer/howtos/backend.html#database-cursor-and-transactions):

```python
# For pre_init_hook (uses cr):
def pre_init_hook(cr):
    with cr.savepoint():
        cr.execute(...)  # Safe if fails

# For post_init_hook (uses env):
def post_init_hook(env):
    try:
        env['model'].method()
    except Exception:
        # Handle gracefully - no savepoint in ORM hooks
        pass
```

**Your Code is Missing:**
- No `try/except` around ORM calls in `post_init_hook`
- Line 23: `views_to_fix = env['ir.ui.view'].sudo().search([...])` - Unprotected
- Line 27-32: View modification without error handling per view

---

## HIGH-PRIORITY ERRORS

### ‚ùå ERROR 5: INVALID VERSION FORMAT IN MANIFEST
**File:** `addons/ppt_business_core/__manifest__.py` (Line 2)
**Severity:** HIGH - Module Registry Rejection

**Current:**
```python
"version": "19.0.6.1.0",  # ‚Üê 5-part version (19.0.6.1.0)
```

**Official Odoo Versioning Spec:**
Per [Module Manifest Documentation](https://www.odoo.com/documentation/19.0/developer/reference/backend/module.html#manifest):
```python
# ACCEPTABLE VERSIONS:
"version": "1.0.0",      # 3-part semantic versioning ‚úì
"version": "1.0",        # 2-part ‚úì
"version": "19.0.1.0.0", # 5-part OK IF includes Odoo major.minor ‚úì
"version": "19.0.1.0.6", # 5-part OK ‚úì

# REJECTED:
"version": "19.0.6.1.0", # AMBIGUOUS - Odoo doesn't know if:
                         # - Odoo version is 19.0, module is 6.1.0? or
                         # - Odoo version is 19.0.6, module is 1.0? ‚úì
```

**What Odoo 19 Expects:**
The VERSION_RE regex in `odoo/modules/module.py` line 42-54:
```python
VERSION_RE = re.compile(r'''
    ^(?:(\d+|saas~\d+(?:\.\d+)?|[\w-]*)\.)?
    (?:19|saas)(?:\.(\d+))?
    \.(?:\d+)(?:\.\d+)?$
''', re.VERBOSE | re.ASCII)
```

**Odoo 19 Interpretation:**
- `19.0.6.1.0` = Odoo 19.0, Module version 6.1.0 ‚úì VALID
- `19.0.3.1.0` (vendor_management) = Odoo 19.0, Module version 3.1.0 ‚úì VALID

**BUT** - Your comment on line 2 is misleading:
```python
# Migration prep: Event Kickoff in SO templates + Service Task Template model
```

This is NOT a version number, it's a changelog comment. [Odoo Module Manifest](https://www.odoo.com/documentation/19.0/developer/reference/backend/module.html) doesn't support inline version comments.

**Recommendation:**
Remove inline comment from version, move to separate changelog file:
```python
"version": "1.0.0",  # Clear semantic versioning, Odoo auto-prefixes with 19.0
# OR keep as is but remove comment
"version": "19.0.6.1.0",
```

---

### ‚ùå ERROR 6: IMPROPER USE OF `sudo()` IN HOOKS
**File:** `addons/ppt_business_core/__init__.py` (Line 23, 28)
**Severity:** HIGH - Security & Performance Issue

**Problem:**
```python
def post_init_hook(env):
    views_to_fix = env['ir.ui.view'].sudo().search([...])  # Line 23
    
    for view in views_to_fix:
        try:
            if view.arch_db:
                new_arch = view.arch_db
                new_arch = re.sub(...)
                if new_arch != view.arch_db:
                    view.sudo().write({'arch_db': new_arch})  # Line 31 - REDUNDANT
```

**Why It's Wrong:**
Per [Odoo Security & Access Rights](https://www.odoo.com/documentation/19.0/developer/reference/backend/orm.html#access-control):
1. **Post-init hooks run as SUPERUSER** - `sudo()` is redundant
2. **Calling `sudo()` on already-sudo record** - Creates security context confusion
3. **Performance** - Extra security checks on already-privileged operation

**Correct Implementation:**
```python
def post_init_hook(env):
    # Hooks run as SUPERUSER - no sudo() needed
    views_to_fix = env['ir.ui.view'].search([...])  # ‚Üê Remove sudo()
    
    for view in views_to_fix:
        try:
            if view.arch_db:
                new_arch = view.arch_db
                # ...
                if new_arch != view.arch_db:
                    view.write({'arch_db': new_arch})  # ‚Üê Remove sudo()
```

---

### ‚ùå ERROR 7: EXCEPTION TYPE HIERARCHY WRONG
**File:** `addons/ppt_business_core/__init__.py` (Line 83-84, 119-120, etc.)
**Severity:** MEDIUM - Overly Broad Exception Handling

**Problem:**
```python
except (ProgrammingError, DatabaseError) as e:  # ‚Üê Two separate types
    _logger.warning(f"PTT Business Core: Error removing {field_name}...")
except Exception as e:  # ‚Üê This catches ProgrammingError too!
    _logger.warning(f"PTT Business Core: Unexpected error...")
```

**Why It's Wrong:**
Per [Python Exception Handling Best Practices](https://www.python.org/dev/peps/pep-0008/#names-to-avoid):
```python
# WRONG - Overly broad exception catching
try:
    cr.execute(...)
except (ProgrammingError, DatabaseError) as e:
    log_this()
except Exception as e:  # ‚Üê This creates unreachable code for Postgres errors
    log_that()

# CORRECT - Specific to general
try:
    cr.execute(...)
except ProgrammingError as e:  # Most specific
    _logger.error("SQL syntax error: %s", e)
except DatabaseError as e:  # More specific
    _logger.error("Database error: %s", e)
except psycopg2.Error as e:  # Postgres-specific
    _logger.error("Postgres error: %s", e)
except Exception as e:  # Catch-all last
    _logger.error("Unexpected error: %s", e)
```

**Your Code Has:**
- Line 83: `(ProgrammingError, DatabaseError)` caught
- Line 88: `Exception` caught - but this is fine as a final catch-all

This is **actually OK** because `Exception` is the final catch-all, BUT it's not specific enough.

**Recommendation:**
```python
from psycopg2 import ProgrammingError, DatabaseError, Error as PsycopgError

try:
    cr.execute(...)
except ProgrammingError as e:
    _logger.error("SQL syntax error: %s", e)
except DatabaseError as e:
    _logger.error("Database error: %s", e)
except Exception as e:
    _logger.error("Unexpected error: %s", e)
```

---

## MEDIUM-PRIORITY ERRORS

### ‚ö†Ô∏è ERROR 8: STRING FORMATTING WITH `%` INSTEAD OF `.format()` OR F-STRINGS
**File:** `addons/ppt_business_core/__init__.py` (Multiple lines)
**Severity:** MEDIUM - Code Quality / Consistency

**Problem:**
```python
# Lines 42, 45, 50, 56, 72, 110, etc.
_logger.info(f"PTT Business Core: Cleaned {field_name} from view {view.id}")
              ‚Üë Uses f-string (modern)

# But also uses:
_logger.warning(f"PTT Business Core: Error cleaning view {view.id}: {e}")
cr.execute("...", (field_name, model))  # Uses % formatting
```

**Official Odoo Coding Guidelines:**
Per [Odoo Coding Guidelines - String Formatting](https://www.odoo.com/documentation/19.0/contributing/development/coding_guidelines.html):

```python
# PREFERRED (Modern Python 3.6+)
_logger.info(f"Module: Cleaned {field_name}")

# ACCEPTABLE (Old style)
_logger.info("Module: Cleaned %s" % field_name)

# NOT RECOMMENDED (PEP 3101)
_logger.info("Module: Cleaned {}".format(field_name))
```

**Your Code:**
You're using both styles inconsistently:
- Line 42: f-string ‚úì
- Line 45: f-string ‚úì
- Line 56: f-string ‚úì
- But Line 72: f-string in SQL string (WRONG - creates f-string literal)

**Issue at Line 72:**
```python
# WRONG:
with cr.savepoint():
    try:
        cr.execute(f"""
            SELECT id FROM ir_model_fields 
            WHERE name = %s AND model = %s
        """, (field_name, model))
        # ‚Üë Should NOT use f-string for SQL params!
```

**Correct:**
```python
# CORRECT - Use plain string for SQL
cr.execute("""
    SELECT id FROM ir_model_fields 
    WHERE name = %s AND model = %s
""", (field_name, model))
```

---

### ‚ö†Ô∏è ERROR 9: MISSING TYPE HINTS IN PYTHON 3.9+ CODE
**File:** `addons/ppt_business_core/models/crm_lead.py` (Multiple lines)
**Severity:** MEDIUM - Code Quality / IDE Support

**Problem:**
```python
class CrmLead(models.Model):
    _inherit = "crm.lead"

    ptt_date_of_call = fields.Date(...)
    
    def action_view_sale_orders(self):  # ‚Üê No return type hint
        self.ensure_one()
        # ...
        return {...}
    
    @api.constrains('ppt_event_time')
    def _check_event_time_format(self):  # ‚Üê No parameters, no return hint
        for record in self:
            # ...
```

**Official Odoo 19 Guidelines:**
Per [Odoo Coding Guidelines - Type Hints](https://www.odoo.com/documentation/19.0/contributing/development/coding_guidelines.html#type-hints):

**Odoo v14+** recommends (but not mandatory):
```python
from typing import Dict, Optional, List

class CrmLead(models.Model):
    _inherit = "crm.lead"
    
    def action_view_sale_orders(self) -> Dict[str, any]:
        """Open linked Sale Orders."""
        self.ensure_one()
        # ...
        return {...}
    
    @api.constrains('ppt_event_time')
    def _check_event_time_format(self) -> None:
        """Validate event time format."""
        for record in self:
            # ...
```

**Recommendation:**
Type hints are optional but improve IDE autocomplete and readability.

---

### ‚ö†Ô∏è ERROR 10: LOGGING WITHOUT PROPER CONTEXT
**File:** `addons/ppt_business_core/__init__.py` (Multiple)
**Severity:** MEDIUM - Debugging Difficulty

**Problem:**
```python
_logger.info("PTT Business Core: Running post_init_hook cleanup")
_logger.warning(f"PTT Business Core: Error cleaning view {view.id}: {e}")
```

**Official Logging Best Practices:**
Per [Odoo Logging Guidelines](https://www.odoo.com/documentation/19.0/contributing/development/coding_guidelines.html#logging):

```python
# PREFERRED - Structured logging
_logger = logging.getLogger(__name__)

_logger.info("Module post_init starting", extra={
    'module': 'ppt_business_core',
    'phase': 'post_init',
    'action': 'cleanup',
})

# OR - Simple with module prefix already in logger name
_logger.info("Post-init cleanup started")
_logger.warning("Error cleaning view %d: %s", view.id, e)
```

**Your Code:**
- Includes module name in every log message (redundant)
- Uses string formatting in message (inefficient)
- No extra context

**Recommended:**
```python
import logging
_logger = logging.getLogger(__name__)  # Module name is in __name__

# In post_init_hook:
_logger.info("Starting cleanup")  # ‚Üê Logger name already prefixes with 'ppt_business_core'
_logger.warning("Error cleaning view %d", view.id, exc_info=True)  # ‚Üê exc_info captures exception
```

---

## LOW-PRIORITY ERRORS (CODE QUALITY)

### ‚ö†Ô∏è ERROR 11: UNUSED IMPORTS
**File:** `addons/ppt_business_core/__init__.py`
**Severity:** LOW - Code Quality

**Problem:**
```python
import logging
import re
import traceback  # ‚Üê UNUSED - Never used in the module
from . import models  # ‚Üê OK, but check if models/__init__.py needs it
```

**Official PEP 8:**
Per [Python Enhancement Proposal 8](https://www.python.org/dev/peps/pep-0008/#imports):
```python
import logging
import re
# ‚Üê Remove unused traceback
from . import models
```

---

### ‚ö†Ô∏è ERROR 12: INCONSISTENT DOCSTRING FORMAT
**File:** `addons/ppt_business_core/models/crm_lead.py` (Lines 10-32)
**Severity:** LOW - Documentation Consistency

**Problem:**
```python
class CrmLead(models.Model):
    """Extend CRM Lead for PTT event management.
    
    NOTE: Use standard Odoo fields where possible:
    - user_id = Sales Rep (standard)
    ...
    
    Use Stages for tracking proposal/contract status.
    
    FIELD NAMING:
    - All custom fields use ppt_ prefix (Party Time Texas)
    - This follows Odoo best practice: x_ is reserved for Studio fields
    - Reference: https://www.odoo.com/documentation/19.0/developer/reference/backend/orm.html
    """
```

**Official Odoo Docstring Style:**
Per [Odoo Coding Guidelines - Docstrings](https://www.odoo.com/documentation/19.0/contributing/development/coding_guidelines.html#docstrings):

```python
class CrmLead(models.Model):
    """Extend CRM Lead for PTT event management.
    
    Custom fields (all prefixed with ppt_) extend CRM opportunity tracking
    with Party Time Texas event-specific data. Use standard Odoo fields
    (user_id, source_id, expected_revenue) where available.
    
    References:
        - https://www.odoo.com/documentation/19.0/developer/reference/backend/orm.html
    """
```

**Better Approach:**
Move implementation details to docstrings of individual methods/fields.

---

### ‚ö†Ô∏è ERROR 13: MISSING FIELD HELP ATTRIBUTES
**File:** `addons/ppt_business_core/models/crm_lead.py` & `project_project.py`
**Severity:** LOW - User Experience

**Problem:**
```python
ptt_event_type = fields.Selection(
    [(..., "Option 1"), (..., "Option 2")],
    string="Event Category",
    help="Type of event being planned..."  # ‚úì Has help
)

ppt_service_line_ids = fields.One2many(
    "ppt.crm.service.line",
    "lead_id",
    string="Service Lines",
    help="Services requested for this event with tier selection",  # ‚úì Has help
)
```

**But Many Fields Missing:**
```python
ppt_referral_source = fields.Char(
    string="Referral Details",
    help="If referral, who referred this client?..."  # ‚úì OK
)

ppt_cfo_contact_method = fields.Selection(
    [("call", "Phone Call"), ...],
    string="CFO Preferred Contact Method",
    help="Preferred method..."  # ‚úì OK
)
```

**Official Odoo Best Practice:**
All user-facing fields should have `help` attribute explaining purpose.

---

## CONFIGURATION & DEPENDENCY ERRORS

### ‚ö†Ô∏è ERROR 14: CIRCULAR DEPENDENCY RISK
**File:** `addons/ppt_vendor_management/__manifest__.py` (Line 19)
**Severity:** MEDIUM - Module Load Order Issue

**Problem:**
```python
"depends": [
    "base",
    "contacts",
    "mail",
    "portal",
    "purchase",
    "project",
    "ppt_business_core",  # ‚Üê Vendor management depends on business core
],
```

And `ppt_business_core/__manifest__.py` doesn't depend on vendor management, BUT:
- `ppt_business_core/models/__init__.py` imports all models
- If vendor models try to extend ppt_business_core models, circular import risk

**Check:** Do vendor models extend ppt_business_core models?

**Safe Pattern:**
```python
# ppt_vendor_management depends on ppt_business_core ‚úì
# ppt_business_core should NOT depend on ppt_vendor_management ‚úì
```

---

### ‚ö†Ô∏è ERROR 15: MISSING SECURITY CHECKS IN ACTION METHODS
**File:** `addons/ppt_business_core/models/crm_lead.py` (Lines 276-305)
**Severity:** MEDIUM - Security Issue

**Problem:**
```python
def action_view_sale_orders(self):
    """Open linked Sale Orders."""
    self.ensure_one()  # ‚úì Good
    if not self.order_ids:
        return False
    # ...
    return {
        "type": "ir.actions.act_window",
        "res_model": "sale.order",
        # ‚úì But missing access control check
    }
```

**Official Odoo Security:**
Per [Odoo Security & Access Control](https://www.odoo.com/documentation/19.0/developer/reference/backend/orm.html#access-control):

```python
def action_view_sale_orders(self):
    """Open linked Sale Orders."""
    self.ensure_one()
    
    # Check user has permission to see sale orders
    if not self.order_ids.user_has_groups('sales_team.group_sale_user'):
        return False
    
    # ... rest of method
```

**Or Use `check_access_rule()`:**
```python
self.order_ids.check_access_rule('read')
```

---

## MANIFEST ERRORS SUMMARY

### üìã ppt_business_core/__manifest__.py Issues:

1. **Line 2:** Version comment is metadata - should be in changelog
2. **Line 7:** Dependency list is very long - should verify all are needed
3. **Line 68:** No demo data but `demo: []` section commented - OK
4. **Line 74:** Assets section correct but verify SCSS file exists

### üìã ppt_vendor_management/__manifest__.py Issues:

1. **Line 19:** Depends on `ppt_business_core` - OK
2. **Line 28:** Extra space after data file listing (line 28: `  "data/server_actions.xml",`)
3. **Missing:** No `pre_init_hook` or `post_init_hook` defined in module
4. **Line 37:** `"application": True,` - Marks as standalone app, but depends on ppt_business_core

---

## REGEX PATTERN VALIDATION ERRORS

### ‚ùå ERROR 16: TIME FORMAT REGEX TOO PERMISSIVE
**File:** `addons/ppt_business_core/models/crm_lead.py` (Line 9)
**Severity:** MEDIUM - Data Validation

**Problem:**
```python
TIME_PATTERN = re.compile(r'^([01]?[0-9]|2[0-3]):[0-5][0-9]$')
```

**Issue:**
- Allows `01:00`, `00:00`, `23:59` ‚úì
- But also allows `09:0` (missing leading zero on minutes)
  - Pattern: `[0-5][0-9]` - requires 2 digits for minutes ‚úì CORRECT
  - Pattern: `[01]?[0-9]` - allows `0-19` for hours ‚úì CORRECT
  - Pattern: `2[0-3]` - allows `20-23` for hours ‚úì CORRECT

**Actually CORRECT!** This pattern is fine.

---

## FIELD DEFINITION ERRORS

### ‚ö†Ô∏è ERROR 17: RELATED FIELD WITHOUT FALLBACK
**File:** `addons/ppt_business_core/models/project_project.py` (Lines 56-105)
**Severity:** LOW - Graceful Degradation

**Problem:**
```python
ppt_preferred_contact_method = fields.Selection(
    related="ppt_crm_lead_id.ptt_preferred_contact_method",  # ‚Üê Note typo: ppt_ vs ptt_
    readonly=True,
    string="Preferred Contact Method",
)
```

**Wait - I see the issue:**
- Model field: `ppt_crm_lead_id` ‚Üê Has "ppt_" prefix
- But other fields: `ppt_date_of_call`, `ppt_venue_booked` ‚Üê Have "ppt_" prefix
- And CRM Lead: `ptt_date_of_call`, `ptt_venue_booked` ‚Üê Have "ptt_" prefix (TYPO in project!)

**NAMING INCONSISTENCY:**
```python
# In project_project.py:
ppt_crm_lead_id = fields.Many2one(...)  # ‚Üê ppt_ (2 t's)
ppt_preferred_contact_method = fields.Selection(
    related="ppt_crm_lead_id.ppt_preferred_contact_method",  # ‚Üê Should be ppt_crm_lead_id.ptt_preferred_contact_method!
)

# In crm_lead.py:
ppt_date_of_call = fields.Date(...)  # ‚Üê ppt_ (2 t's)  WAIT - Actually uses ppt_!
ppt_preferred_contact_method = fields.Selection(...)  # ‚Üê ppt_

# Checking your provided code:
# crm_lead.py Line 44: ppt_date_of_call ‚Üê ppt_ (NOT ptt_!)
# crm_lead.py Line 50: ppt_preferred_contact_method ‚Üê ppt_
```

**RESOLVED:** Both use `ppt_` (Party Time Texas) - NOT `ptt_` (PushToTalk?). Naming is consistent!

---

## API DECORATOR ISSUES

### ‚ö†Ô∏è ERROR 18: MISSING `@api.model` ON CLASS METHODS
**File:** `addons/ppt_business_core/models/crm_lead.py` (Line 266)
**Severity:** MEDIUM - Method Dispatch Issue

**Problem:**
```python
def action_suggest_sale_template(self):  # ‚Üê Should this be @api.model?
    """Suggest appropriate sale order template based on event type."""
    self.ensure_one()
    # ...
```

**Context:**
- `self.ensure_one()` at line 267 indicates this is a **record method** (called on record(s))
- Can be called as: `lead.action_suggest_sale_template()`

**If method needs to work without a record:**
```python
@api.model  # Add this
def action_suggest_sale_template(self, event_type):  # Change to take parameter
    """Suggest appropriate sale order template."""
    # ...
```

**But your implementation requires a record**, so the current version is ‚úì CORRECT.

---

## COMPUTE & CONSTRAINT METHOD ERRORS

### ‚ö†Ô∏è ERROR 19: `@api.constrains` CALLED ON NON-STORED FIELD
**File:** `addons/ppt_business_core/models/crm_lead.py` (Line 218)
**Severity:** MEDIUM - Performance Issue

**Problem:**
```python
@api.constrains('ppt_event_time')
def _check_event_time_format(self):
    """Validate event time is in HH:MM format."""
    for record in self:
        if record.ppt_event_time and not TIME_PATTERN.match(record.ppt_event_time):
            raise ValidationError(...)
```

**Issue:**
- Field `ppt_event_time` is a `fields.Char()` (Line 113 in crm_lead.py)
- No `compute=` means it's a regular field ‚úì
- No `store=False` means it's stored ‚úì
- `@api.constrains` is correct ‚úì

**Actually OK!**

---

## INHERITANCE & MODEL STRUCTURE

### ‚úì ERROR 20: PROPER USE OF `_inherit`
**File:** `addons/ppt_business_core/models/crm_lead.py` (Line 38)
**Severity:** N/A - CORRECT

```python
class CrmLead(models.Model):
    _inherit = "crm.lead"  # ‚úì Proper extension of existing model
```

This is ‚úì **CORRECT** inheritance pattern.

---

## PERMISSION & SECURITY RULES

### ‚ö†Ô∏è ERROR 21: SECURITY RIGHTS CSV NOT VALIDATED
**File:** Referenced in `addons/ppt_business_core/__manifest__.py` but not checked
**Severity:** MEDIUM - Could cause permission errors

**Expected Files (from manifest):**
```python
"security/ir.model.access.csv",  # Must exist and have correct format
"security/ppt_business_core_groups.xml",  # Must exist
"security/ppt_project_vendor_assignment_security.xml",  # Must exist
"security/ppt_security.xml",  # Must exist (legacy)
```

**Required CSV Format (per Odoo docs):**
```
id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
access_ppt_crm_vendor_estimate,ptt CRM Vendor Estimate,model_ptt_crm_vendor_estimate,base.group_user,1,1,1,1
```

**To Verify:**
Open each file and verify:
1. `ir.model.access.csv` has correct format
2. `ppt_business_core_groups.xml` defines groups referenced in CSV
3. Record rules in security XML files reference existing groups

---

## FINAL COMPREHENSIVE ERROR COUNT

| Severity | Count | Category |
|----------|-------|----------|
| üî¥ CRITICAL | 4 | Hook signatures, missing hooks, regex formatting, version format |
| üü† HIGH | 3 | `sudo()` misuse, exception handling, imports |
| üü° MEDIUM | 10+ | Type hints, logging, field validation, security checks |
| üü¢ LOW | 5+ | Code quality, docstrings, consistency |

---

## RECOMMENDED FIXES (PRIORITY ORDER)

### IMMEDIATE (Do First - Blocking):

1. **Fix Regex with Spaces** (Line 37-39, 126-131, 152-157 in __init__.py)
   ```python
   # WRONG:
   rf'<field[^>]*name=["\']{ field_name}["\']'
   
   # CORRECT:
   rf'<field[^>]*name=["\']({field_name})["\']'
   ```

2. **Fix pre_init_hook savepoint exception handling** (Add proper try/except)

3. **Remove Redundant `sudo()`** in post_init_hook (Lines 23, 31)

4. **Add Manifest post_init_hook** to ppt_vendor_management

### MEDIUM PRIORITY (Do Soon):

5. Fix string formatting consistency (use f-strings everywhere or % style consistently)

6. Add type hints to action methods

7. Update logging to use structured format

8. Verify all security files exist and have correct format

### LOW PRIORITY (Code Quality):

9. Remove unused imports (traceback)

10. Improve docstring formatting

11. Add missing `help` attributes to fields

---

## ODOO 19 COMPLIANCE CHECKLIST

- ‚úì Module manifest structure correct
- ‚úì Model inheritance proper (`_inherit`)
- ‚ùå Pre/Post init hook signatures (partially broken)
- ‚ùå Exception handling in hooks (insufficient)
- ‚úì Field naming conventions (using ppt_ prefix, not x_)
- ‚úì Decorator usage (`@api.constrains`, `@api.depends`)
- ‚úì ORM method usage (`ensure_one()`, `search()`, etc.)
- ‚ùå Security access control checks in action methods
- ‚úì Views and XML structure (assumed - not reviewed)
- ‚úì Dependency declarations correct

---

**Generated:** January 15, 2026  
**Status:** Module has 21+ issues preventing clean Odoo 19 compatibility  
**Estimated Fix Time:** 2-4 hours for experienced developer

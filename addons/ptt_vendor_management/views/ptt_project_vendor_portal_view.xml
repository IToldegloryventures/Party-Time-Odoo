<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!--
        PTT Vendor Management - SAFE Project View Extension
        
        DESIGN RULES (non-negotiable):
        1. inherit ONLY project.edit_project (core Odoo)
        2. No replace operations
        3. No object buttons in Project view
        4. No workflow logic in Project view
        5. One isolated page with One2many only
        
        All vendor workflow (Send WO, Resend, signatures, decline) 
        belongs in ptt.project.vendor.assignment views, NOT here.
    -->

    <!-- SAFE Project Vendor Display -->
    <record id="project_project_form_inherit_ptt_vendor_safe"
            model="ir.ui.view">

        <field name="name">project.project.form.inherit.ptt.vendor.safe</field>
        <field name="model">project.project</field>

        <!-- ALWAYS inherit core project - NEVER a custom parent view -->
        <field name="inherit_id" ref="project.edit_project"/>

        <field name="arch" type="xml">
            <!-- SAFE: //notebook always exists in project.edit_project -->
            <xpath expr="//notebook" position="inside">

                <page name="ptt_vendors"
                      string="Vendors"
                      groups="ptt_vendor_management.group_vendor_user">

                    <!-- 
                        SAFE: Only display the One2many relation
                        All buttons/workflow live in the assignment's own form view
                    -->
                    <field name="ptt_vendor_assignment_ids"
                           nolabel="1"
                           mode="tree,form"
                           context="{'default_project_id': active_id}"/>

                </page>

            </xpath>
        </field>
    </record>

</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- 
        Vendor Application Portal Templates
        
        Public-facing application form for vendors to apply to work with Party Time Texas.
        
        Routes:
        - /vendor/apply - Main application form (logged in users)
        - /my/applications - List of user's applications  
        - /my/application/<id> - Application detail/status page
    -->
    
    <!-- ==================== PUBLIC APPLICATION PAGE ==================== -->
    
    <template id="portal_vendor_application" name="Vendor Application Form">
        <t t-call="portal.portal_layout">
            <t t-set="no_breadcrumbs" t-value="True"/>
            
            <div class="container py-4">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        
                        <!-- Header -->
                        <div class="text-center mb-4">
                            <h1 class="text-primary">Vendor Application</h1>
                            <p class="lead text-muted">
                                Join our network of quality vendors
                            </p>
                        </div>
                        
                        <!-- Error Message -->
                        <t t-if="error">
                            <div class="alert alert-danger">
                                <i class="fa fa-exclamation-circle me-2"/>
                                <t t-esc="error"/>
                            </div>
                        </t>
                        
                        <!-- Success Message -->
                        <t t-if="success">
                            <div class="alert alert-success">
                                <h4><i class="fa fa-check-circle me-2"/>Application Submitted!</h4>
                                <p class="mb-0">
                                    Thank you for applying. We will review your application and contact you soon.
                                    <a href="/my/applications">View your applications</a>
                                </p>
                            </div>
                        </t>
                        
                        <!-- Application Form -->
                        <t t-if="not success">
                            <form action="/vendor/apply" method="post" 
                                  enctype="multipart/form-data" class="needs-validation">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                
                                <!-- Progress Indicator -->
                                <div class="mb-4">
                                    <div class="d-flex justify-content-between text-muted small mb-2">
                                        <span>Profile</span>
                                        <span>Services</span>
                                        <span>Documents</span>
                                        <span>Submit</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-primary" role="progressbar" 
                                             style="width: 25%;" id="formProgress"/>
                                    </div>
                                    <small class="text-muted">Step <span id="currentStep">1</span> of 4</small>
                                </div>
                                
                                <!-- ===== STEP 1: COMPANY INFORMATION ===== -->
                                <div class="card mb-4" id="step1">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fa fa-building me-2"/>
                                            Step 1: Company Information
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="name" class="form-label">
                                                    Company Name <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" class="form-control" id="name" name="name" 
                                                       required="required" t-att-value="kw.get('name', '')"/>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="principal_name" class="form-label">
                                                    Principal/Owner Name
                                                </label>
                                                <input type="text" class="form-control" id="principal_name" 
                                                       name="principal_name" t-att-value="kw.get('principal_name', '')"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="email" class="form-label">
                                                    Company Email <span class="text-danger">*</span>
                                                </label>
                                                <input type="email" class="form-control" id="email" name="email" 
                                                       required="required" t-att-value="kw.get('email', partner.email if partner else '')"/>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="phone" class="form-label">
                                                    Company Phone <span class="text-danger">*</span>
                                                </label>
                                                <input type="tel" class="form-control" id="phone" name="phone" 
                                                       required="required" t-att-value="kw.get('phone', partner.phone if partner else '')"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="additional_phone" class="form-label">Additional Phone</label>
                                                <input type="tel" class="form-control" id="additional_phone" 
                                                       name="additional_phone" t-att-value="kw.get('additional_phone', '')"/>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="website_url" class="form-label">Website</label>
                                                <input type="url" class="form-control" id="website_url" 
                                                       name="website_url" placeholder="https://"
                                                       t-att-value="kw.get('website_url', '')"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ===== STEP 2: ADDRESS ===== -->
                                <div class="card mb-4" id="step2">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fa fa-map-marker me-2"/>
                                            Step 2: Business Address
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <label for="street" class="form-label">
                                                    Street Address <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" class="form-control" id="street" name="street" 
                                                       required="required" t-att-value="kw.get('street', '')"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <label for="street2" class="form-label">Street Address 2</label>
                                                <input type="text" class="form-control" id="street2" name="street2"
                                                       t-att-value="kw.get('street2', '')"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <label for="city" class="form-label">
                                                    City <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" class="form-control" id="city" name="city" 
                                                       required="required" t-att-value="kw.get('city', '')"/>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="state_id" class="form-label">
                                                    State <span class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="state_id" name="state_id" required="required">
                                                    <option value="">Select State...</option>
                                                    <t t-foreach="states" t-as="state">
                                                        <option t-att-value="state.id" 
                                                                t-att-selected="str(state.id) == str(kw.get('state_id', ''))">
                                                            <t t-esc="state.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <label for="zip" class="form-label">
                                                    ZIP Code <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" class="form-control" id="zip" name="zip" 
                                                       required="required" pattern="[0-9]{5}(-[0-9]{4})?"
                                                       t-att-value="kw.get('zip', '')"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="zip_radius" class="form-label">
                                                    Service Radius (miles)
                                                </label>
                                                <input type="number" class="form-control" id="zip_radius" 
                                                       name="zip_radius" min="0" max="500" step="5"
                                                       placeholder="How far you travel for events"
                                                       t-att-value="kw.get('zip_radius', '50')"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ===== STEP 3: SERVICES ===== -->
                                <div class="card mb-4" id="step3">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fa fa-list-check me-2"/>
                                            Step 3: Services Offered
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">
                                            Select all services you can provide. 
                                            <span class="text-danger">* At least one service is required.</span>
                                        </p>
                                        <div class="row">
                                            <t t-foreach="services" t-as="service">
                                                <div class="col-md-4 col-6 mb-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" 
                                                               name="service_ids[]" 
                                                               t-att-value="service.id"
                                                               t-att-id="'service_%s' % service.id"/>
                                                        <label class="form-check-label" t-att-for="'service_%s' % service.id">
                                                            <t t-esc="service.name"/>
                                                        </label>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                        
                                        <hr class="my-4"/>
                                        
                                        <div class="mb-3">
                                            <label for="vendor_notes" class="form-label">
                                                Additional Information About Your Services
                                            </label>
                                            <textarea class="form-control" id="vendor_notes" name="vendor_notes" 
                                                      rows="3" placeholder="Tell us more about your experience, equipment, specialties, etc."><t t-esc="kw.get('vendor_notes', '')"/></textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ===== STEP 4: DOCUMENTS ===== -->
                                <div class="card mb-4" id="step4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fa fa-file-alt me-2"/>
                                            Step 4: Required Documents
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">
                                            Please upload the following documents. Required documents are marked with 
                                            <span class="text-danger">*</span>. 
                                            You can also upload documents later from your portal.
                                        </p>
                                        
                                        <t t-foreach="document_types" t-as="doc_type">
                                            <div class="card mb-3">
                                                <div class="card-body">
                                                    <div class="row align-items-center">
                                                        <div class="col-md-6">
                                                            <label t-att-for="'doc_%s' % doc_type.id" class="form-label mb-0">
                                                                <t t-esc="doc_type.name"/>
                                                                <t t-if="doc_type.required">
                                                                    <span class="text-danger">*</span>
                                                                </t>
                                                            </label>
                                                            <t t-if="doc_type.description">
                                                                <br/><small class="text-muted"><t t-esc="doc_type.description"/></small>
                                                            </t>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <input type="file" class="form-control" 
                                                                   t-att-id="'doc_%s' % doc_type.id"
                                                                   t-att-name="'doc_%s' % doc_type.id"
                                                                   accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                                                                   t-att-required="'required' if doc_type.required else None"/>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <t t-if="doc_type.has_expiry">
                                                                <label t-att-for="'doc_%s_validity' % doc_type.id" class="form-label small">
                                                                    Expiry Date
                                                                </label>
                                                                <input type="date" class="form-control form-control-sm" 
                                                                       t-att-id="'doc_%s_validity' % doc_type.id"
                                                                       t-att-name="'doc_%s_validity' % doc_type.id"/>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                                
                                <!-- ===== TERMS AND SUBMIT ===== -->
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="agree_terms" 
                                                   name="agree_terms" required="required"/>
                                            <label class="form-check-label" for="agree_terms">
                                                I certify that the information provided is accurate and complete. 
                                                I agree to the <a href="#" target="_blank">Terms of Service</a> 
                                                and <a href="#" target="_blank">Vendor Agreement</a>.
                                                <span class="text-danger">*</span>
                                            </label>
                                        </div>
                                        
                                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fa fa-paper-plane me-2"/>
                                                Submit Application
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                            </form>
                        </t>
                        
                    </div>
                </div>
            </div>
            
        </t>
    </template>
    
    
    <!-- ==================== MY APPLICATIONS LIST ==================== -->
    
    <template id="portal_my_vendor_applications" name="My Vendor Applications">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">My Applications</t>
            </t>
            
            <t t-if="not applications">
                <div class="alert alert-info mt-3">
                    <i class="fa fa-info-circle me-2"/>
                    You have no vendor applications.
                    <a href="/vendor/apply" class="alert-link">Apply now</a>
                </div>
            </t>
            
            <t t-if="applications">
                <div class="table-responsive mt-3">
                    <table class="table table-hover o_portal_my_doc_table">
                        <thead class="bg-light">
                            <tr>
                                <th>Company Name</th>
                                <th>Applied Date</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Documents</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="applications" t-as="app">
                                <tr>
                                    <td>
                                        <strong><t t-esc="app.name"/></strong>
                                    </td>
                                    <td>
                                        <t t-esc="app.create_date" t-options="{'widget': 'date'}"/>
                                    </td>
                                    <td class="text-center">
                                        <span t-attf-class="badge rounded-pill #{
                                            'bg-secondary' if app.ptt_vendor_status == 'new' else
                                            'bg-warning text-dark' if app.ptt_vendor_status == 'pending_review' else
                                            'bg-success' if app.ptt_vendor_status == 'active' else
                                            'bg-danger'
                                        }">
                                            <t t-if="app.ptt_vendor_status == 'new'">New</t>
                                            <t t-elif="app.ptt_vendor_status == 'pending_review'">Under Review</t>
                                            <t t-elif="app.ptt_vendor_status == 'active'">Approved</t>
                                            <t t-elif="app.ptt_vendor_status == 'inactive'">Inactive</t>
                                            <t t-else=""><t t-esc="app.ptt_vendor_status"/></t>
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-light text-dark">
                                            <t t-esc="len(app.ptt_vendor_document_ids)"/> uploaded
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <a t-attf-href="/my/application/#{app.id}" 
                                           class="btn btn-sm btn-primary">
                                            <i class="fa fa-eye me-1"/>View
                                        </a>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </t>
            
        </t>
    </template>
    
    
    <!-- ==================== APPLICATION DETAIL PAGE ==================== -->
    
    <template id="portal_vendor_application_detail" name="Vendor Application Detail">
        <t t-call="portal.portal_layout">
            
            <div class="container py-4">
                <div class="row">
                    <div class="col-12">
                        <!-- Back Link -->
                        <a href="/my/applications" class="btn btn-link ps-0 mb-3">
                            <i class="fa fa-arrow-left me-2"/> Back to Applications
                        </a>
                        
                        <!-- Header -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2><t t-esc="vendor.name"/></h2>
                            <span t-attf-class="badge rounded-pill fs-6 #{
                                'bg-secondary' if vendor.ptt_vendor_status == 'new' else
                                'bg-warning text-dark' if vendor.ptt_vendor_status == 'pending_review' else
                                'bg-success' if vendor.ptt_vendor_status == 'active' else
                                'bg-danger'
                            }">
                                <t t-if="vendor.ptt_vendor_status == 'new'">New Application</t>
                                <t t-elif="vendor.ptt_vendor_status == 'pending_review'">Under Review</t>
                                <t t-elif="vendor.ptt_vendor_status == 'active'">Approved Vendor</t>
                                <t t-elif="vendor.ptt_vendor_status == 'inactive'">Inactive</t>
                            </span>
                        </div>
                        
                        <!-- Status Messages -->
                        <t t-if="vendor.ptt_vendor_status == 'pending_review'">
                            <div class="alert alert-warning">
                                <i class="fa fa-clock me-2"/>
                                Your application is currently under review. We will notify you once a decision is made.
                            </div>
                        </t>
                        
                        <t t-if="vendor.ptt_vendor_status == 'active'">
                            <div class="alert alert-success">
                                <i class="fa fa-check-circle me-2"/>
                                Congratulations! You are an approved vendor. 
                                <a href="/my/work-orders">View your work orders</a>
                            </div>
                        </t>
                        
                        <div class="row">
                            <!-- Company Info Card -->
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fa fa-building me-2"/>Company Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4">Name</dt>
                                            <dd class="col-sm-8"><t t-esc="vendor.name"/></dd>
                                            
                                            <dt class="col-sm-4">Email</dt>
                                            <dd class="col-sm-8"><t t-esc="vendor.email"/></dd>
                                            
                                            <dt class="col-sm-4">Phone</dt>
                                            <dd class="col-sm-8"><t t-esc="vendor.phone"/></dd>
                                            
                                            <t t-if="vendor.street">
                                                <dt class="col-sm-4">Address</dt>
                                                <dd class="col-sm-8">
                                                    <t t-esc="vendor.street"/><br/>
                                                    <t t-if="vendor.street2"><t t-esc="vendor.street2"/><br/></t>
                                                    <t t-esc="vendor.city"/>, 
                                                    <t t-esc="vendor.state_id.code"/> 
                                                    <t t-esc="vendor.zip"/>
                                                </dd>
                                            </t>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Services Card -->
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="fa fa-tags me-2"/>Services</h5>
                                    </div>
                                    <div class="card-body">
                                        <t t-if="vendor.ptt_vendor_service_types">
                                            <t t-foreach="vendor.ptt_vendor_service_types" t-as="service_type">
                                                <span class="badge bg-primary me-1 mb-1">
                                                    <t t-esc="service_type.name"/>
                                                </span>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <p class="text-muted mb-0">No services selected</p>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Documents Section -->
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fa fa-file-alt me-2"/>Documents</h5>
                                <a t-attf-href="/my/application/#{vendor.id}/upload" class="btn btn-sm btn-primary">
                                    <i class="fa fa-upload me-1"/> Upload Document
                                </a>
                            </div>
                            <div class="card-body">
                                <t t-if="vendor.ptt_vendor_document_ids">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead class="bg-light">
                                                <tr>
                                                    <th>Document Type</th>
                                                    <th>Status</th>
                                                    <th>Uploaded</th>
                                                    <th>Expiry</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="vendor.ptt_vendor_document_ids" t-as="doc">
                                                    <tr>
                                                        <td><t t-esc="doc.document_type_id.name"/></td>
                                                        <td>
                                                            <span t-attf-class="badge #{
                                                                'bg-success' if doc.status == 'compliant' else
                                                                'bg-warning text-dark' if doc.status == 'expiring_soon' else
                                                                'bg-danger' if doc.status == 'non_compliant' else
                                                                'bg-secondary'
                                                            }">
                                                                <t t-esc="dict(doc._fields['status'].selection).get(doc.status, doc.status)"/>
                                                            </span>
                                                        </td>
                                                        <td><t t-esc="doc.create_date" t-options="{'widget': 'date'}"/></td>
                                                        <td>
                                                            <t t-if="doc.validity">
                                                                <t t-esc="doc.validity" t-options="{'widget': 'date'}"/>
                                                            </t>
                                                            <t t-else="">N/A</t>
                                                        </td>
                                                        <td class="text-end">
                                                            <a t-attf-href="/my/application/#{vendor.id}/document/#{doc.id}/download" 
                                                               class="btn btn-sm btn-outline-primary">
                                                                <i class="fa fa-download"/>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="alert alert-warning mb-0">
                                        <i class="fa fa-exclamation-triangle me-2"/>
                                        No documents uploaded yet. Please upload required documents to complete your application.
                                    </div>
                                </t>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            
        </t>
    </template>
    
    
    <!-- ==================== PORTAL HOME EXTENSIONS ==================== -->
    
    <!-- Add "My Applications" count to portal home -->
    <template id="portal_my_home_vendor_applications" 
              name="Vendor Applications Count"
              inherit_id="portal.portal_my_home"
              priority="40">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/ptt_vendor_management/static/description/icon.png'"/>
                <t t-set="title">Vendor Applications</t>
                <t t-set="url" t-value="'/my/applications'"/>
                <t t-set="text">View your vendor applications</t>
                <t t-set="placeholder_count" t-value="'application_count'"/>
            </t>
        </xpath>
    </template>
    
</odoo>

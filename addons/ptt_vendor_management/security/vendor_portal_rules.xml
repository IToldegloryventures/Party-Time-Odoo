<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- 
            Vendor Portal Security Rules
            
            CRITICAL: Vendors can ONLY see their own assignments.
            They CANNOT see:
            - Customer pricing
            - Other vendors on same event
            - Profitability data
            - Full project details
            
            Reference: https://www.odoo.com/documentation/19.0/developer/reference/backend/security.html
        -->
        
        <!-- Portal vendors can ONLY see their own work order assignments -->
        <record id="ptt_vendor_assignment_portal_rule" model="ir.rule">
            <field name="name">Vendor Portal: Own Work Orders Only</field>
            <field name="model_id" ref="ptt_business_core.model_ptt_project_vendor_assignment"/>
            <field name="domain_force">[('vendor_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Portal vendors can see projects they're assigned to (LIMITED READ ONLY) -->
        <record id="project_project_portal_vendor_rule" model="ir.rule">
            <field name="name">Vendor Portal: See Assigned Projects Only</field>
            <field name="model_id" ref="project.model_project_project"/>
            <field name="domain_force">[('ptt_vendor_assignment_ids.vendor_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Portal vendors can only access their own documents -->
        <record id="ptt_vendor_document_portal_rule" model="ir.rule">
            <field name="name">Vendor Portal: Own Documents Only</field>
            <field name="model_id" ref="model_ptt_vendor_document"/>
            <field name="domain_force">[('vendor_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Portal vendors can only see RFQs they are invited to -->
        <record id="ptt_vendor_rfq_portal_rule" model="ir.rule">
            <field name="name">Vendor Portal: Invited RFQs Only</field>
            <field name="model_id" ref="model_ptt_vendor_rfq"/>
            <field name="domain_force">[('vendor_ids', 'in', user.partner_id.ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Portal vendors can only see/edit their own quotes -->
        <record id="ptt_vendor_quote_history_portal_rule" model="ir.rule">
            <field name="name">Vendor Portal: Own Quotes Only</field>
            <field name="model_id" ref="model_ptt_vendor_quote_history"/>
            <field name="domain_force">[('vendor_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Portal vendors can only see/update their own tasks -->
        <record id="ptt_vendor_task_portal_rule" model="ir.rule">
            <field name="name">Vendor Portal: Own Tasks Only</field>
            <field name="model_id" ref="model_ptt_vendor_task"/>
            <field name="domain_force">[('vendor_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
    </data>
</odoo>

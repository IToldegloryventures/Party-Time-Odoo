<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ptt_super_dashboard.OperationsDashboard">
        <div class="ptt-operations-dashboard">
            <!-- Date Range Filter - Segmented Control Style -->
            <div class="ptt-date-filter">
                <div class="d-flex align-items-center gap-3 flex-wrap">
                    <div class="btn-group" role="group">
                        <button 
                            t-att-class="'btn btn-sm' + (state.dateRange === 'today' ? ' active' : '')"
                            t-on-click="() => this.setDateRange('today')">
                            Today
                        </button>
                        <button 
                            t-att-class="'btn btn-sm' + (state.dateRange === 'this_week' ? ' active' : '')"
                            t-on-click="() => this.setDateRange('this_week')">
                            This Week
                        </button>
                        <button 
                            t-att-class="'btn btn-sm' + (state.dateRange === 'this_month' ? ' active' : '')"
                            t-on-click="() => this.setDateRange('this_month')">
                            This Month
                        </button>
                        <button 
                            t-att-class="'btn btn-sm' + (state.dateRange === 'last_month' ? ' active' : '')"
                            t-on-click="() => this.setDateRange('last_month')">
                            Last Month
                        </button>
                        <button 
                            t-att-class="'btn btn-sm' + (state.dateRange === 'this_quarter' ? ' active' : '')"
                            t-on-click="() => this.setDateRange('this_quarter')">
                            Quarter
                        </button>
                        <button 
                            t-att-class="'btn btn-sm' + (state.dateRange === 'this_year' ? ' active' : '')"
                            t-on-click="() => this.setDateRange('this_year')">
                            Year
                        </button>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <input type="date" class="form-control form-control-sm" style="width: 140px; border-radius: 8px;"
                            t-model="state.startDate" t-on-change="onDateChange"/>
                        <span class="text-muted small">to</span>
                        <input type="date" class="form-control form-control-sm" style="width: 140px; border-radius: 8px;"
                            t-model="state.endDate" t-on-change="onDateChange"/>
                    </div>
                    <span class="badge bg-light text-dark border" style="padding: 0.5rem 0.75rem; font-weight: 500;">
                        <i class="fa fa-calendar me-1"/>
                        <t t-esc="dateRangeLabel"/>
                    </span>
                </div>
            </div>
            
            <!-- Loading State -->
            <t t-if="state.loading">
                <div class="ptt-loading">
                    <div class="ptt-spinner"/>
                </div>
            </t>
            
            <t t-elif="state.data">
                <!-- Company Total Section -->
                <div class="ptt-section-header mb-3">
                    <h2><i class="fa fa-building"/> Company Total</h2>
                </div>
                
                <!-- Main KPI Cards - Company Total -->
                <div class="ptt-kpi-grid mb-4">
                    <!-- POs Month to Date -->
                    <div class="ptt-kpi-card" t-if="state.data.po_metrics">
                        <div class="ptt-kpi-icon" style="background: #DBEAFE; color: #2563EB;">
                            <i class="fa fa-shopping-cart"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatCurrency(state.data.po_metrics.total_amount)"/>
                        <div class="ptt-kpi-label">POs Month to Date</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.po_metrics.count"/> POs
                        </div>
                    </div>
                    
                    <!-- Refunds -->
                    <div class="ptt-kpi-card" t-if="state.data.refund_metrics">
                        <div class="ptt-kpi-icon" style="background: #FEE2E2; color: #DC2626;">
                            <i class="fa fa-undo"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatCurrency(state.data.refund_metrics.total_amount)"/>
                        <div class="ptt-kpi-label">Refunds Being Issued</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.refund_metrics.count"/> refunds
                        </div>
                    </div>
                    
                    <!-- Rain Delays -->
                    <div class="ptt-kpi-card" t-if="state.data.rain_delay_metrics">
                        <div class="ptt-kpi-icon" style="background: #FEF3C7; color: #D97706;">
                            <i class="fa fa-cloud-rain"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.rain_delay_metrics.count"/>
                        <div class="ptt-kpi-label">Rain Delays</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.rain_delay_metrics.percentage"/>% of events
                        </div>
                    </div>
                    
                    <!-- Time to Collect -->
                    <div class="ptt-kpi-card" t-if="state.data.collection_time">
                        <div class="ptt-kpi-icon" style="background: #DCFCE7; color: #16A34A;">
                            <i class="fa fa-clock-o"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatDays(state.data.collection_time.avg_days)"/>
                        <div class="ptt-kpi-label">Avg Time to Collect</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.collection_time.invoice_count"/> invoices
                        </div>
                    </div>
                    
                    <!-- Avg Time to Event -->
                    <div class="ptt-kpi-card" t-if="state.data.avg_time_to_event">
                        <div class="ptt-kpi-icon" style="background: #E0E7FF; color: #6366F1;">
                            <i class="fa fa-calendar"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatDays(state.data.avg_time_to_event.avg_days)"/>
                        <div class="ptt-kpi-label">Avg Time to Event</div>
                        <div class="ptt-kpi-count">
                            Lead â†’ Event
                        </div>
                    </div>
                </div>
                
                <!-- Task Metrics Section -->
                <div class="ptt-section-header mb-3 mt-4" t-if="state.data.task_metrics">
                    <h2><i class="fa fa-tasks"/> Task Metrics</h2>
                </div>
                
                <div class="ptt-kpi-grid mb-4" t-if="state.data.task_metrics">
                    <div class="ptt-kpi-card" t-on-click="() => this.onTaskMetricClick('assigned')">
                        <div class="ptt-kpi-icon" style="background: #DBEAFE; color: #2563EB;">
                            <i class="fa fa-user"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.task_metrics.total_assigned"/>
                        <div class="ptt-kpi-label">Total Assigned</div>
                    </div>
                    
                    <div class="ptt-kpi-card" t-on-click="() => this.onTaskMetricClick('overdue')">
                        <div class="ptt-kpi-icon" style="background: #FEE2E2; color: #DC2626;">
                            <i class="fa fa-exclamation-triangle"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.task_metrics.overdue"/>
                        <div class="ptt-kpi-label">Overdue</div>
                    </div>
                    
                    <div class="ptt-kpi-card" t-on-click="() => this.onTaskMetricClick('unassigned')">
                        <div class="ptt-kpi-icon" style="background: #FEF3C7; color: #D97706;">
                            <i class="fa fa-user-slash"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.task_metrics.unassigned"/>
                        <div class="ptt-kpi-label">Unassigned</div>
                    </div>
                    
                    <div class="ptt-kpi-card" t-on-click="() => this.onTaskMetricClick('completed')">
                        <div class="ptt-kpi-icon" style="background: #DCFCE7; color: #16A34A;">
                            <i class="fa fa-check-circle"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.task_metrics.completed"/>
                        <div class="ptt-kpi-label">Completed</div>
                    </div>
                </div>
                
                <!-- Communication Metrics Section -->
                <div class="ptt-section-header mb-3 mt-4" t-if="state.data.communication_metrics">
                    <h2><i class="fa fa-comments"/> Communication Metrics</h2>
                </div>
                
                <div class="ptt-kpi-grid mb-4" t-if="state.data.communication_metrics">
                    <div class="ptt-kpi-card">
                        <div class="ptt-kpi-icon" style="background: #E0E7FF; color: #6366F1;">
                            <i class="fa fa-comments"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.communication_metrics.open_discussions"/>
                        <div class="ptt-kpi-label">Open Discussions</div>
                        <div class="ptt-kpi-count">Last 30 days</div>
                    </div>
                    
                    <div class="ptt-kpi-card">
                        <div class="ptt-kpi-icon" style="background: #DBEAFE; color: #2563EB;">
                            <i class="fa fa-envelope"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.communication_metrics.messages_sent"/>
                        <div class="ptt-kpi-label">Messages Sent</div>
                        <div class="ptt-kpi-count">Last 30 days</div>
                    </div>
                </div>
                
                <!-- Event Level Metrics -->
                <div class="ptt-section-header mb-3 mt-4">
                    <h2><i class="fa fa-chart-bar"/> Event Level Metrics</h2>
                </div>
                
                <div class="ptt-kpi-grid mb-4" t-if="state.data.event_metrics">
                    <div class="ptt-kpi-card">
                        <div class="ptt-kpi-icon" style="background: #DCFCE7; color: #16A34A;">
                            <i class="fa fa-dollar"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatCurrency(state.data.event_metrics.avg_revenue_per_event)"/>
                        <div class="ptt-kpi-label">Avg $ per Event</div>
                        <div class="ptt-kpi-count">
                            Min: <t t-esc="formatCurrency(state.data.event_metrics.min_revenue)"/> | 
                            Max: <t t-esc="formatCurrency(state.data.event_metrics.max_revenue)"/>
                        </div>
                    </div>
                    
                    <div class="ptt-kpi-card">
                        <div class="ptt-kpi-icon" style="background: #DBEAFE; color: #2563EB;">
                            <i class="fa fa-cogs"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.event_metrics.avg_services_per_event"/>
                        <div class="ptt-kpi-label">Avg Services/Event</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.event_metrics.total_events"/> events
                        </div>
                    </div>
                    
                    <div class="ptt-kpi-card">
                        <div class="ptt-kpi-icon" style="background: #FEF3C7; color: #D97706;">
                            <i class="fa fa-list"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="state.data.event_metrics.avg_line_items_per_event"/>
                        <div class="ptt-kpi-label">Avg Line Items/Event</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.event_metrics.total_events"/> events
                        </div>
                    </div>
                </div>
                
                <!-- All Users Section -->
                <div class="ptt-section-header mb-3 mt-4">
                    <h2><i class="fa fa-users"/> All Users Performance</h2>
                </div>
                
                <div class="ptt-card" style="background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #E5E7EB; overflow: hidden;" t-if="state.data.users">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" style="background: white;">
                            <thead style="background: #F9FAFB;">
                                <tr>
                                    <th style="font-weight: 600; font-size: 0.85rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; padding: 1rem;">User</th>
                                    <th class="text-center" style="font-weight: 600; font-size: 0.85rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; padding: 1rem;">Tasks Assigned</th>
                                    <th class="text-center" style="font-weight: 600; font-size: 0.85rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; padding: 1rem;">Overdue</th>
                                    <th class="text-center" style="font-weight: 600; font-size: 0.85rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; padding: 1rem;">Completed</th>
                                    <th class="text-center" style="font-weight: 600; font-size: 0.85rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; padding: 1rem;">Messages</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="state.data.users" t-as="user" t-key="user.id">
                                    <tr style="background: white;">
                                        <td style="padding: 1rem; vertical-align: middle;">
                                            <div class="d-flex align-items-center">
                                                <div class="me-3">
                                                    <span class="badge" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.95rem; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);">
                                                        <t t-esc="user.initials"/>
                                                    </span>
                                                </div>
                                                <div>
                                                    <strong style="font-size: 1rem; color: #1F2937;"><t t-esc="user.name"/></strong>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center" style="padding: 1rem; vertical-align: middle;">
                                            <span class="badge bg-info" style="font-size: 0.95rem; padding: 0.5rem 0.75rem; font-weight: 600;">
                                                <t t-esc="user.task_total_assigned || 0"/>
                                            </span>
                                        </td>
                                        <td class="text-center" style="padding: 1rem; vertical-align: middle;">
                                            <span t-att-class="'badge ' + (user.task_overdue > 0 ? 'bg-danger' : 'bg-secondary')" style="font-size: 0.95rem; padding: 0.5rem 0.75rem; font-weight: 600;">
                                                <t t-esc="user.task_overdue || 0"/>
                                            </span>
                                        </td>
                                        <td class="text-center" style="padding: 1rem; vertical-align: middle;">
                                            <span class="badge bg-success" style="font-size: 0.95rem; padding: 0.5rem 0.75rem; font-weight: 600;">
                                                <t t-esc="user.task_completed || 0"/>
                                            </span>
                                        </td>
                                        <td class="text-center" style="padding: 1rem; vertical-align: middle;">
                                            <span class="badge bg-primary" style="font-size: 0.95rem; padding: 0.5rem 0.75rem; font-weight: 600;">
                                                <t t-esc="user.messages_sent || 0"/>
                                            </span>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </t>
        </div>
    </t>
</templates>


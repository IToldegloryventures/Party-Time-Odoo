<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ptt_operational_dashboard.SalesDashboard">
        <div class="ptt-sales-dashboard">
            <!-- Date Range Filter -->
            <div class="ptt-date-filter mb-4">
                <div class="d-flex align-items-center gap-3 flex-wrap">
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary btn-sm" t-on-click="() => this.setDateRange('this_month')">This Month</button>
                        <button class="btn btn-outline-secondary btn-sm" t-on-click="() => this.setDateRange('last_month')">Last Month</button>
                        <button class="btn btn-outline-secondary btn-sm" t-on-click="() => this.setDateRange('this_quarter')">This Quarter</button>
                        <button class="btn btn-outline-secondary btn-sm" t-on-click="() => this.setDateRange('this_year')">This Year</button>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <input type="date" class="form-control form-control-sm" style="width: 140px;"
                            t-model="state.startDate" t-on-change="onDateChange"/>
                        <span class="text-muted">to</span>
                        <input type="date" class="form-control form-control-sm" style="width: 140px;"
                            t-model="state.endDate" t-on-change="onDateChange"/>
                    </div>
                    <span class="badge bg-secondary" t-esc="dateRangeLabel"/>
                </div>
            </div>
            
            <!-- Loading State -->
            <t t-if="state.loading">
                <div class="ptt-loading">
                    <div class="ptt-spinner"/>
                </div>
            </t>
            
            <t t-elif="state.data">
                <!-- Main KPI Cards -->
                <div class="ptt-kpi-grid mb-4">
                    <!-- Total Booked -->
                    <div class="ptt-kpi-card booked" t-on-click="onBookedClick">
                        <div class="ptt-kpi-icon booked">
                            <i class="fa fa-calendar-check-o"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatCurrency(state.data.total_booked)"/>
                        <div class="ptt-kpi-label">Total Booked</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.booked_count"/> events
                        </div>
                    </div>
                    
                    <!-- Total Paid -->
                    <div class="ptt-kpi-card paid" t-on-click="onPaidClick">
                        <div class="ptt-kpi-icon paid">
                            <i class="fa fa-check-circle"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatCurrency(state.data.total_paid)"/>
                        <div class="ptt-kpi-label">Total Paid</div>
                        <div class="ptt-kpi-count">
                            <t t-esc="state.data.paid_count"/> invoices
                        </div>
                    </div>
                    
                    <!-- Outstanding/Overdue -->
                    <div class="ptt-kpi-card outstanding" t-on-click="onOutstandingClick">
                        <div class="ptt-kpi-icon outstanding">
                            <i class="fa fa-exclamation-circle"/>
                        </div>
                        <div class="ptt-kpi-value" t-esc="formatCurrency(state.data.total_outstanding)"/>
                        <div class="ptt-kpi-label">Outstanding</div>
                        <div class="ptt-kpi-count text-danger" t-if="state.data.overdue_amount > 0">
                            <t t-esc="formatCurrency(state.data.overdue_amount)"/> overdue
                        </div>
                    </div>
                </div>
                
                <!-- Sales Rep Cards -->
                <div class="ptt-section-header">
                    <h2><i class="fa fa-users"/> Sales Team Performance</h2>
                </div>
                
                <div class="ptt-rep-grid">
                    <t t-foreach="state.data.reps" t-as="rep" t-key="rep.id">
                        <div class="ptt-rep-card" t-on-click="() => this.onRepClick(rep)">
                            <div class="ptt-rep-header">
                                <div class="ptt-rep-avatar" t-att-style="'background-color: ' + (rep.color || '#6366F1')">
                                    <t t-esc="rep.initials"/>
                                </div>
                                <div class="ptt-rep-name" t-esc="rep.name"/>
                            </div>
                            <div class="ptt-rep-stats">
                                <div class="ptt-rep-stat">
                                    <span class="label">Booked</span>
                                    <span class="value" t-esc="formatCurrency(rep.booked_amount)"/>
                                </div>
                                <div class="ptt-rep-stat">
                                    <span class="label">Events</span>
                                    <span class="value" t-esc="rep.booked_count"/>
                                </div>
                                <div class="ptt-rep-stat">
                                    <span class="label">Leads</span>
                                    <span class="value" t-esc="rep.leads_count"/>
                                </div>
                            </div>
                            <div class="ptt-rep-progress">
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar" 
                                        t-att-style="'width: ' + (rep.conversion_rate || 0) + '%'"
                                        t-att-class="rep.conversion_rate > 50 ? 'bg-success' : rep.conversion_rate > 25 ? 'bg-warning' : 'bg-danger'"/>
                                </div>
                                <small class="text-muted">
                                    <t t-esc="rep.conversion_rate"/>% conversion
                                </small>
                            </div>
                        </div>
                    </t>
                </div>
                
                <!-- Empty state for reps -->
                <t t-if="!state.data.reps || state.data.reps.length === 0">
                    <div class="ptt-card">
                        <div class="ptt-empty-state">
                            <i class="fa fa-users"/>
                            <p>No sales data for this period</p>
                        </div>
                    </div>
                </t>
            </t>
        </div>
    </t>
</templates>

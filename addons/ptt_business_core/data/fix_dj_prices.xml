<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        
        <record id="action_fix_dj_prices" model="ir.actions.server">
            <field name="name">Fix DJ Prices (Force $300 Base)</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="state">code</field>
            <field name="code">
# =============================================================
# FIX DJ PRICES - Force correct pricing
# =============================================================

# Find DJ template by name (more reliable than XML ID after deletions)
dj_template = env['product.template'].search([
    '|',
    ('name', 'ilike', 'DJ Services'),
    ('name', 'ilike', 'DJ &amp; MC'),
], limit=1)

if not dj_template:
    raise UserError("DJ Services product not found!")

# Force base price to $300
dj_template.write({
    'list_price': 300.0,
    'standard_price': 150.0,
})

# Price extras for variants
PRICE_EXTRAS = {
    # Event Type (applied to event attribute values)
    'Social': 0.0,
    'Corporate': 0.0,
    'Wedding': 50.0,
    # Service Tier (applied to tier attribute values)
    'Essentials': 0.0,
    'Essential': 0.0,  # Handle both spellings
    'Classic': 125.0,
    'Premier': 300.0,
}

# Update price_extra on product.template.attribute.value records
updated = 0
for attr_line in dj_template.attribute_line_ids:
    for ptav in attr_line.product_template_value_ids:
        value_name = ptav.product_attribute_value_id.name
        if value_name in PRICE_EXTRAS:
            ptav.write({'price_extra': PRICE_EXTRAS[value_name]})
            updated += 1

# Return success
action = {
    'type': 'ir.actions.client',
    'tag': 'display_notification',
    'params': {
        'title': 'DJ Prices Fixed!',
        'message': f'Base price set to $300. Updated {updated} price extras. Variants: Social/Corp Essential=$300, Classic=$425, Premier=$600. Wedding adds $50.',
        'sticky': True,
        'type': 'success',
    }
}
            </field>
        </record>
        
        <menuitem id="menu_fix_dj_prices"
            name="Fix DJ Prices"
            parent="sale.menu_sale_config"
            action="action_fix_dj_prices"
            sequence="97"
            groups="base.group_system"/>
        
    </data>
</odoo>

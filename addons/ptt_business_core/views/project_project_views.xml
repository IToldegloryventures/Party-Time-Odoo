<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Project Form Extension -->
        <record id="view_project_form_ptt" model="ir.ui.view">
            <field name="name">project.project.form.ptt</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                
                <!-- Rename Description tab to Notes and keep it -->
                <xpath expr="//page[@name='description']" position="attributes">
                    <attribute name="string">Notes</attribute>
                </xpath>
                
                <!-- Add our custom note fields to the Notes tab (formerly Description) -->
                <xpath expr="//page[@name='description']//field[@name='description']" position="after">
                    <group string="Event Notes">
                        <field name="ptt_event_notes" nolabel="1" placeholder="General event notes..."/>
                    </group>
                    <group string="Special Requirements">
                        <field name="ptt_special_requirements" nolabel="1" placeholder="Special requirements..."/>
                    </group>
                    <group string="Client Preferences">
                        <field name="ptt_client_preferences" nolabel="1" placeholder="Client preferences..."/>
                    </group>
                </xpath>
                
                <!-- Add our tabs BEFORE the notebook's first page to control order -->
                <xpath expr="//notebook/page[1]" position="before">
                    
                    <!-- 1. PTT Event Details (FIRST) -->
                    <page string="Event Details" name="ptt_event_details">
                        <group>
                            <group string="Event Details" name="event_identity">
                                <field name="ptt_crm_lead_id" string="CRM Lead"/>
                                <field name="ptt_event_name" string="Event Name"/>
                                <field name="ptt_event_type" string="Event Type"/>
                                <field name="ptt_guest_count" string="Guest Count"/>
                                <field name="ptt_venue_address" string="Address"/>
                                <!-- Venue Details (conditional on Venue Booked) -->
                                <field name="ptt_venue_booked" string="Venue Booked?" widget="boolean_toggle"/>
                                <field name="ptt_venue_name" string="Venue Name" 
                                       invisible="not ptt_venue_booked"/>
                                <field name="ptt_location_type" string="Venue Type"
                                       invisible="not ptt_venue_booked"/>
                            </group>
                            <group string="Event Schedule" name="event_schedule">
                                <field name="ptt_event_date" string="Event Date"/>
                                <field name="ptt_event_start_time_float" string="Start Time"/>
                                <field name="ptt_event_end_time_float" string="End Time"/>
                                <field name="ptt_setup_time" string="Setup Time"/>
                                <field name="ptt_teardown_time" string="Teardown Time"/>
                            </group>
                        </group>
                        <group>
                            <group string="Vendor Notes" colspan="2">
                                <field name="ptt_vendor_notes" nolabel="1" 
                                       placeholder="Notes for all vendors (parking, load-in, building access, etc.)..."/>
                            </group>
                        </group>
                    </page>
                </xpath>
                
                <!-- Move Notes tab (formerly Description) after Event Details -->
                <xpath expr="//page[@name='ptt_event_details']" position="after">
                    <!-- Notes tab will appear here due to Odoo's view inheritance -->
                </xpath>
                
                <!-- Add Event Directory placeholder after where Notes will be -->
                <xpath expr="//page[@name='description']" position="after">
                    <!-- 3. Event Directory - placeholder, will be filled by ptt_project_management -->
                    <page string="Event Directory" name="stakeholders">
                        <div class="alert alert-info" role="status">
                            Contact directory is available in PTT Project Management module.
                        </div>
                    </page>
                    
                    <!-- 4. Vendor Assignments -->
                    <page string="Vendor Assignments" name="ptt_vendors">
                        <!-- Profitability Dashboard -->
                        <div class="row mb-4">
                            <div class="col-md-3 d-flex">
                                <div class="card bg-primary text-white flex-fill h-100">
                                    <div class="card-body text-center py-3">
                                        <h6 class="card-subtitle mb-1 opacity-75">Client Revenue</h6>
                                        <h4 class="card-title mb-0">
                                            <field name="ptt_client_total" widget="monetary" nolabel="1"/>
                                        </h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex">
                                <div class="card bg-info text-white flex-fill h-100">
                                    <div class="card-body text-center py-3">
                                        <h6 class="card-subtitle mb-1 opacity-75">Est. Vendor Costs</h6>
                                        <h4 class="card-title mb-0">
                                            <field name="ptt_total_estimated_cost" widget="monetary" nolabel="1"/>
                                        </h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex">
                                <div class="card bg-warning flex-fill h-100">
                                    <div class="card-body text-center py-3">
                                        <h6 class="card-subtitle mb-1">Actual Costs</h6>
                                        <h4 class="card-title mb-0">
                                            <field name="ptt_total_actual_cost" widget="monetary" nolabel="1"/>
                                        </h4>
                                        <small class="text-muted">
                                            Variance: <field name="ptt_cost_variance" widget="monetary" nolabel="1"/>
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 d-flex">
                                <div class="card bg-success text-white flex-fill h-100">
                                    <div class="card-body text-center py-3">
                                        <h6 class="card-subtitle mb-1 opacity-75">Profit Margin</h6>
                                        <h4 class="card-title mb-0">
                                            <field name="ptt_actual_margin" widget="monetary" nolabel="1"/>
                                        </h4>
                                        <small>
                                            (<field name="ptt_margin_percent" nolabel="1"/>%)
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <group>
                            <group string="Vendor Summary">
                                <field name="ptt_vendor_count" readonly="1"/>
                            </group>
                        </group>
                        
                        <separator string="Vendor Assignments"/>
                        <field name="ptt_vendor_assignment_ids" nolabel="1">
                            <list editable="bottom">
                                <field name="service_type"/>
                                <field name="vendor_id"/>
                                <field name="vendor_name"/>
                                <field name="estimated_cost"/>
                                <field name="actual_cost"/>
                                <field name="status"/>
                                <field name="service_date"/>
                            </list>
                        </field>
                    </page>
                    
                    <!-- 5. Settings tab comes last (it's from Odoo standard, we just moved it via attributes) -->

                </xpath>
            </field>
        </record>

        <!-- Project Tree Extension -->
        <record id="view_project_tree_ptt" model="ir.ui.view">
            <field name="name">project.project.tree.ptt</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.view_project"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="ptt_event_date" optional="show"/>
                    <field name="ptt_guest_count" optional="hide"/>
                    <field name="ptt_client_total" string="Revenue" optional="show" widget="monetary"/>
                    <field name="ptt_actual_margin" string="Margin" optional="show" widget="monetary"
                           decoration-success="ptt_actual_margin &gt; 0"
                           decoration-danger="ptt_actual_margin &lt; 0"/>
                    <field name="ptt_margin_percent" string="%" optional="hide"/>
                </field>
            </field>
        </record>

    </data>
</odoo>

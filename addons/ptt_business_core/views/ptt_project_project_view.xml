<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        PTT Project Form View Extension
        
        IMPORTANT: This view is DISABLED by default (active=False)
        
        KNOWN ISSUES FIXED:
        1. REMOVED embedded <list> and <form> views inside One2many
           - These cause OwlError: Cannot read properties of undefined (reading 'type')
           - Odoo 19 has issues with complex embedded views in inherited forms
        2. REMOVED statusbar replacement
           - Can conflict with base Odoo view structure
        3. REMOVED complex banner/header
           - Simplify to just notebook pages
        
        TO RE-ENABLE: Set active="True" after verifying all fields exist
    -->
    
    <!-- DISABLED - This view was causing OwlError on Project app -->
    <!-- DO NOT ENABLE until database views are cleaned up -->
    <record id="view_project_form_ptt" model="ir.ui.view">
        <field name="name">project.project.form.ptt</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="active" eval="False"/>
        <field name="arch" type="xml">
            <!-- 
                SAFE VERSION: Only add simple notebook pages
                NO embedded forms, NO statusbar modifications, NO complex xpaths
            -->
            <xpath expr="//notebook" position="inside">
                
                <!-- CLIENT TAB - Simple field references only -->
                <page name="ptt_client_tab" string="PTT Client Info">
                    <group string="Client &amp; Event">
                        <group>
                            <field name="partner_id" string="Client" readonly="1"/>
                            <field name="ptt_crm_lead_id" string="CRM Lead"/>
                        </group>
                        <group>
                            <field name="ptt_event_id"/>
                            <field name="ptt_event_type"/>
                            <field name="ptt_event_date"/>
                            <field name="ptt_guest_count"/>
                        </group>
                    </group>
                </page>
                
                <!-- FINANCIALS TAB -->
                <page name="ptt_financials_tab" string="PTT Financials">
                    <group string="Revenue">
                        <group>
                            <field name="sale_order_id"/>
                            <field name="ptt_total_revenue" widget="monetary"/>
                        </group>
                        <group>
                            <field name="ptt_guest_count" string="Guests"/>
                            <field name="ptt_revenue_per_guest" widget="monetary"/>
                        </group>
                    </group>
                    <group string="Costs &amp; Profit">
                        <group>
                            <field name="ptt_total_vendor_cost" widget="monetary"/>
                            <field name="ptt_gross_profit" widget="monetary"/>
                        </group>
                        <group>
                            <field name="ptt_cost_per_guest" widget="monetary"/>
                            <field name="ptt_profit_margin" widget="percentage"/>
                        </group>
                    </group>
                </page>
                
                <!-- 
                    VENDORS TAB - REMOVED
                    
                    The embedded <list> and <form> views were causing OwlError.
                    Vendor assignments are now displayed by ptt_vendor_management module
                    using its own safe view: ptt_project_vendor_portal_view.xml
                    
                    If you need vendor assignments in ptt_business_core only,
                    create a standalone view for ptt.project.vendor.assignment model
                    and reference it here without embedded forms.
                -->
                
            </xpath>
        </field>
    </record>
    
    <!--
        STANDALONE VENDOR ASSIGNMENT VIEWS
        
        These views are used by Odoo when displaying ptt_vendor_assignment_ids
        on the project form. They are SAFE because they're not embedded.
    -->
    <record id="ptt_project_vendor_assignment_tree_simple" model="ir.ui.view">
        <field name="name">ptt.project.vendor.assignment.tree.simple</field>
        <field name="model">ptt.project.vendor.assignment</field>
        <field name="arch" type="xml">
            <list editable="bottom">
                <field name="service_type"/>
                <field name="vendor_id"/>
                <field name="ptt_status" widget="badge"/>
                <field name="actual_cost" widget="monetary"/>
            </list>
        </field>
    </record>
    
    <record id="ptt_project_vendor_assignment_form_simple" model="ir.ui.view">
        <field name="name">ptt.project.vendor.assignment.form.simple</field>
        <field name="model">ptt.project.vendor.assignment</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="service_type"/>
                            <field name="vendor_id"/>
                            <field name="ptt_status"/>
                        </group>
                        <group>
                            <field name="actual_cost" widget="monetary"/>
                            <field name="ptt_confirmed_date"/>
                        </group>
                    </group>
                    <group string="Contact">
                        <field name="ptt_contact_person"/>
                        <field name="ptt_contact_phone"/>
                        <field name="ptt_arrival_time"/>
                    </group>
                    <group string="Notes">
                        <field name="notes" nolabel="1"/>
                        <field name="ptt_equipment_notes" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

</odoo>

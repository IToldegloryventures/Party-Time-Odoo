<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- CRM Lead Form Extension -->
        <record id="view_crm_lead_form_ptt" model="ir.ui.view">
            <field name="name">crm.lead.form.ptt</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="arch" type="xml">
                
                <!-- Add Generate Event ID button -->
                <xpath expr="//header" position="inside">
                    <button name="action_generate_event_id" type="object"
                        string="Generate Event ID" class="btn-secondary"
                        invisible="ptt_event_id or type == 'lead'"
                        help="Generate a unique event ID for tracking across all modules"/>
                </xpath>
                
                <!-- Add stat buttons -->
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_view_sale_orders" type="object"
                        class="oe_stat_button" icon="fa-shopping-cart"
                        invisible="ptt_sale_order_count == 0 or type == 'lead'">
                        <div class="o_stat_info">
                            <span class="o_stat_value"><field name="ptt_sale_order_count"/></span>
                            <span class="o_stat_text">Sale Orders</span>
                        </div>
                    </button>
                    <button name="action_view_invoices" type="object"
                        class="oe_stat_button" icon="fa-file-text-o"
                        invisible="ptt_invoice_count == 0 or type == 'lead'">
                        <div class="o_stat_info">
                            <span class="o_stat_value"><field name="ptt_invoice_count"/></span>
                            <span class="o_stat_text">Invoices</span>
                        </div>
                    </button>
                    <button name="action_view_project" type="object"
                        class="oe_stat_button" icon="fa-tasks"
                        invisible="not ptt_project_id">
                        <div class="o_stat_info">
                            <span class="o_stat_value"><field name="ptt_project_count"/></span>
                            <span class="o_stat_text">Project</span>
                        </div>
                    </button>
                </xpath>

                <!-- Add PTT Event Pages -->
                <xpath expr="//notebook" position="inside">
                    
                    <!-- PTT Event Intake - Consolidated Tab -->
                    <page string="Event Intake" name="ptt_lead_intake">
                        
                        <!-- Event Information Section -->
                        <separator string="Event Information"/>
                        <group>
                            <group>
                                <field name="ptt_event_name"/>
                                <field name="ptt_event_type_id"/>
                                <field name="ptt_attire"/>
                                <field name="ptt_guest_count"/>
                            </group>
                            <group>
                                <field name="ptt_event_date"/>
                                <field name="ptt_setup_time" widget="float_time"/>
                                <field name="ptt_start_time" widget="float_time"/>
                                <field name="ptt_end_time" widget="float_time"/>
                            </group>
                        </group>
                        
                        <!-- Venue Section -->
                        <separator string="Venue"/>
                        <group>
                            <group>
                                <field name="ptt_venue_booked"/>
                                <field name="ptt_venue_name"/>
                                <field name="ptt_location_type"/>
                            </group>
                            <group>
                                <field name="ptt_venue_address"/>
                            </group>
                        </group>
                        
                        <!-- Contact Information Section -->
                        <separator string="Contact Information"/>
                        <group>
                            <group>
                                <field name="ptt_date_of_call"/>
                                <field name="ptt_lead_type"/>
                                <field name="ptt_preferred_contact"/>
                            </group>
                            <group string="Secondary Contact">
                                <field name="ptt_secondary_contact_name"/>
                                <field name="ptt_secondary_contact_phone"/>
                                <field name="ptt_secondary_contact_email"/>
                            </group>
                        </group>
                        
                        <!-- Follow-up Section -->
                        <separator string="Follow-up"/>
                        <group>
                            <group>
                                <field name="ptt_event_id" readonly="1"/>
                                <field name="ptt_followup_email_sent"/>
                                <field name="ptt_proposal_sent"/>
                                <field name="ptt_next_contact_date"/>
                            </group>
                            <group>
                                <field name="ptt_project_id" readonly="1"/>
                                <field name="ptt_payment_status"/>
                            </group>
                        </group>
                    </page>

                    <!-- Service Notes -->
                    <page string="Service Notes" name="ptt_service_notes">
                        <field name="ptt_service_notes" nolabel="1"
                               placeholder="Enter internal service notes, special requests, or important details..."/>
                    </page>

                    <!-- Budget & Vendors -->
                    <page string="Budget &amp; Vendors" name="ptt_budget">
                        <!-- Financial Summary Dashboard -->
                        <div class="row mb-4">
                            <div class="col-md-4 d-flex">
                                <div class="card bg-primary text-white flex-fill h-100">
                                    <div class="card-body text-center">
                                        <h6 class="card-subtitle mb-2">Est. Client Revenue</h6>
                                        <h3 class="card-title mb-0">
                                            <field name="ptt_estimated_client_total" widget="monetary" nolabel="1"/>
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex">
                                <div class="card bg-warning flex-fill h-100">
                                    <div class="card-body text-center">
                                        <h6 class="card-subtitle mb-2">Est. Vendor Costs</h6>
                                        <h3 class="card-title mb-0">
                                            <field name="ptt_estimated_vendor_total" widget="monetary" nolabel="1"/>
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex">
                                <div class="card bg-success text-white flex-fill h-100">
                                    <div class="card-body text-center">
                                        <h6 class="card-subtitle mb-2">Est. Margin</h6>
                                        <h3 class="card-title mb-0">
                                            <field name="ptt_estimated_margin" widget="monetary" nolabel="1"/>
                                            <small class="ms-2">(<field name="ptt_margin_percent" nolabel="1"/>%)</small>
                                        </h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <group>
                            <group>
                                <field name="ptt_budget_range"/>
                                <field name="ptt_services_already_booked"/>
                            </group>
                        </group>
                        
                        <separator string="Vendor Cost Estimates"/>
                        <field name="ptt_vendor_estimate_ids" nolabel="1">
                            <list editable="bottom">
                                <field name="service_type"/>
                                <field name="vendor_name"/>
                                <field name="estimated_cost"/>
                                <field name="notes"/>
                            </list>
                        </field>
                        
                        <group>
                            <group>
                                <field name="ptt_estimated_vendor_total"/>
                                <field name="ptt_estimated_client_total"/>
                            </group>
                            <group>
                                <field name="ptt_estimated_margin"/>
                                <field name="ptt_margin_percent"/>
                            </group>
                        </group>
                    </page>

                </xpath>
            </field>
        </record>

        <!-- CRM Lead Tree Extension -->
        <record id="view_crm_lead_tree_ptt" model="ir.ui.view">
            <field name="name">crm.lead.tree.ptt</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="ptt_event_id" optional="show"/>
                    <field name="ptt_event_date" optional="show"/>
                    <field name="ptt_guest_count" optional="hide"/>
                    <field name="ptt_payment_status" optional="show"/>
                </field>
            </field>
        </record>

        <!-- CRM Lead Search Extension -->
        <record id="view_crm_lead_search_ptt" model="ir.ui.view">
            <field name="name">crm.lead.search.ptt</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="ptt_event_id"/>
                    <field name="ptt_event_name"/>
                    <field name="ptt_venue_name"/>
                </field>
                <xpath expr="//filter[@name='filter_won_status_won']" position="after">
                    <separator/>
                    <filter name="filter_corporate" string="Corporate Events" domain="[('ptt_event_type_id', '=', ref('ptt_enhanced_sales.event_type_corporate'))]"/>
                    <filter name="filter_social" string="Social Events" domain="[('ptt_event_type_id', '=', ref('ptt_enhanced_sales.event_type_social'))]"/>
                    <filter name="filter_wedding" string="Wedding Events" domain="[('ptt_event_type_id', '=', ref('ptt_enhanced_sales.event_type_wedding'))]"/>
                    <separator/>
                    <filter name="filter_future_events" string="Future Events" 
                            domain="[('ptt_event_date', '&gt;=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter name="filter_past_events" string="Past Events" 
                            domain="[('ptt_event_date', '&lt;', context_today().strftime('%Y-%m-%d'))]"/>
                </xpath>
                <xpath expr="//group[filter[@name='salesperson']]" position="inside">
                    <filter string="Event Type" name="group_event_type" context="{'group_by': 'ptt_event_type_id'}"/>
                    <filter string="Event Date" name="group_event_date" context="{'group_by': 'ptt_event_date'}"/>
                    <filter string="Payment Status" name="group_payment" context="{'group_by': 'ptt_payment_status'}"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>
